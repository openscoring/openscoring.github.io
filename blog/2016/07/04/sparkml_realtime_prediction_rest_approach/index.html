<!DOCTYPE html>
<html lang=" en-US">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#ffffff" />
  <meta name="msapplication-navbutton-color" content="#ffffff">
  <meta name="apple-mobile-web-app-status-bar-style" content="#ffffff">

  <meta name="description" content="">
  <meta name="keywords" content="apache-spark openscoring">
  <meta name="author" content="vruusmann">

  <title>Using Apache Spark ML pipeline models for real-time prediction: the Openscoring REST web service approach - Openscoring</title>

  <meta name="robots" content="index, follow, max-snippet:-1, max-video-preview:-1, max-image-preview:large" />
  <link rel="canonical" href="https://openscoring.io/blog/2016/07/04/sparkml_realtime_prediction_rest_approach/" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Using Apache Spark ML pipeline models for real-time prediction: the Openscoring REST web service approach - Openscoring" />
  <meta property="og:url" content="/blog/2016/07/04/sparkml_realtime_prediction_rest_approach/" />
  <meta property="og:site_name" content="Openscoring" />
  <meta property="og:updated_time" content="2016-07-04 00:00:00 +0300" />
  <meta property="article:published_time" content="2016-07-04 00:00:00 +0300" />
  <meta property="article:modified_time" content="2016-07-04 00:00:00 +0300" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Using Apache Spark ML pipeline models for real-time prediction: the Openscoring REST web service approach - Openscoring" />
  <meta name="twitter:label1" content="Written by" />
  <meta name="twitter:data1" content="Villu Ruusmann" />
  <meta name="twitter:label2" content="Time to read" />
  <meta name="twitter:data2" content="Less than a minute" />

  <link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
  <link rel='dns-prefetch' href='http://s.w.org/' />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&amp;display=swap' type='text/css' media='all' />
  <script type='text/javascript' src='/assets/js/jquery/jquery.min.js?ver=3.6.0' defer></script>
  <script type='text/javascript' src='/assets/js/jquery/jquery-migrate.min.js?ver=3.3.2' defer></script>
  <link rel="icon" href="/assets/images/fa-150x150.png" sizes="32x32" />
  <link rel="icon" href="/assets/images/fa.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/assets/images/fa.png" />
  <link rel="stylesheet" href="/assets/css/main.css">
  <meta name="msapplication-TileImage" content="h/assets/images/fa.png" />
  <!--[if lt IE 9]>
  	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
  <header class="c-head">
  <div class="c-head__container container-p0">
    <a class="c-head__logo" href="/"><img src="/assets/images/logo.svg" alt="" /></a>
    <nav class="c-head__nav">
      <ul id="menu-main-menu" class="c-head__menu">
        <li><a href="/" aria-current="page">Home</a></li>
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/#products" aria-current="page">Products</a></li>
        <li><a href="/#licensing" aria-current="page">Licensing</a></li>
        <li><a href="/#consulting" aria-current="page">Consulting</a></li>
      </ul>
    </nav>
    <button id="menu-toggle" class="c-head__toggle c-toggle" type="button">
      <span class="c-toggle__line c-toggle__top"></span>
      <span class="c-toggle__line c-toggle__mid"></span>
      <span class="c-toggle__line c-toggle__bot"></span>
    </button>
  </div>
</header>

  <div class="single-post">
  <div class="c-entry-header bg-b bg-b--cover">
    <h1 class="c-entry-header__title h3 container-p0">Using Apache Spark ML pipeline models for real-time prediction: the Openscoring REST web service approach</h1>
  </div>
  
  <main class="gb-content">
    <p><a href="https://spark.apache.org/">Apache Spark</a> follows the batch data processing paradigm, which has its strengths and weaknesses.
On one hand, the batch processing is suitable for working with Big Data-scale datasets. Apache Spark splits the task into manageable-size batches and distributes the workfload across a cluster of machines.
Apache Spark competitors such as R or Python cannot match that, because they typically require the task to fit into the RAM of a single machine.</p>

<p>On the other hand, the batch processing is characterized by high inertia. Apache Spark falls short in application scenarios where it is necessary to work with small datasets (eg. single data records) in real time.
Essentially, there is a lower bound (instead of an upper bound) to the effective size of a task.</p>

<p>This blog post details a workflow where Apache Spark ML pipeline models are converted to the Predictive Model Markup Language (PMML) representation, and then deployed using the Openscoring REST web service for easy interfacing with third-party applications.</p>

<h3 id="converting-apache-spark-ml-pipeline-models-to-the-pmml-representation">Converting Apache Spark ML pipeline models to the PMML representation</h3>

<p>The support for PMML was <a href="https://databricks.com/blog/2015/07/02/pmml-support-in-apache-spark-mllib.html">introduced</a> in Apache Spark MLlib version 1.4.0 in the form of a <code class="language-plaintext highlighter-rouge">org.apache.spark.mllib.pmml.PMMLExportable</code> trait. The invocation of the <code class="language-plaintext highlighter-rouge">PMMLExportable#toPMML()</code> method (or one of its overloaded variants) produces a PMML document withich contains the symbolic description of the fitted model.</p>

<p>Unfortunately, this solution is not very relevant anymore.
First, Apache Spark ML is organized around the pipeline formalization. A pipeline can be regarded as a directed graph of data transformations and models. When converting a model, then it will be necessary to include all the preceding pipeline stages to the dump.
Second, Apache Spark ML comes with rich metadata. The <code class="language-plaintext highlighter-rouge">DataFrame</code> representation of a dataset is associated with a static schema, which can be queried for column names, data types and more.
Finally, Apache Spark ML has replaced and/or abstracted away a great deal of Apache Spark MLlib APIs. Newer versions of Apache Spark ML have almost completely ceased to rely on Apache Spark MLlib classes that implement the <code class="language-plaintext highlighter-rouge">PMMLExportable</code> trait.</p>

<p>The <a href="https://github.com/jpmml/jpmml-sparkml">JPMML-SparkML</a> library is an independent effort to provide a fully-featured PMML converter for Apache Spark ML pipelines.</p>

<p>The main interaction point is the <code class="language-plaintext highlighter-rouge">org.jpmml.sparkml.ConverterUtil#toPMML(StructType, PipelineModel)</code> utility method.
The conversion engine initializes a PMML document based on the <code class="language-plaintext highlighter-rouge">StructType</code> argument, and fills it with relevant content by iterating over all the pipeline stages of the <code class="language-plaintext highlighter-rouge">PipelineModel</code> argument.</p>

<p>The conversion engine requires a valid class mapping from <code class="language-plaintext highlighter-rouge">org.apache.spark.ml.Transformer</code> to <code class="language-plaintext highlighter-rouge">org.jpmml.sparkml.TransformerConverter</code> for every pipeline stage class.
The class mappings registry is automatically populated for most common transformer and model types. Application developers can implement and register their own <code class="language-plaintext highlighter-rouge">TransformerConverter</code> classes when looking to move beyond that.</p>

<p>Typical usage:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">DataFrame</span> <span class="n">dataFrame</span> <span class="o">=</span> <span class="o">...;</span>
<span class="nc">StructType</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">dataFrame</span><span class="o">.</span><span class="na">schema</span><span class="o">();</span>

<span class="nc">Pipeline</span> <span class="n">pipeline</span> <span class="o">=</span> <span class="o">...;</span>
<span class="nc">PipelineModel</span> <span class="n">pipelineModel</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">dataFrame</span><span class="o">);</span>

<span class="no">PMML</span> <span class="n">pmml</span> <span class="o">=</span> <span class="nc">ConverterUtil</span><span class="o">.</span><span class="na">toPMML</span><span class="o">(</span><span class="n">schema</span><span class="o">,</span> <span class="n">pipelineModel</span><span class="o">);</span>

<span class="nc">JAXBUtil</span><span class="o">.</span><span class="na">marshalPMML</span><span class="o">(</span><span class="n">pmml</span><span class="o">,</span> <span class="k">new</span> <span class="nc">StreamResult</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">));</span>
</code></pre></div></div>

<p>The JPMML-SparkML library depends on a newer version of the <a href="https://github.com/jpmml/jpmml-model">JPMML-Model</a> library than Apache Spark, which introduces severe compile-time and run-time classpath conflicts. The solution is to employ <a href="https://maven.apache.org/plugins/maven-shade-plugin/">Maven Shade Plugin</a> and relocate the affected <code class="language-plaintext highlighter-rouge">org.dmg.pmml</code> and <code class="language-plaintext highlighter-rouge">org.jpmml.(agent|model|schema)</code> packages.</p>

<p>The <a href="https://github.com/jpmml/jpmml-sparkml-bootstrap">JPMML-SparkML-Bootstrap</a> project aims to provide a complete example about developing and packaging an JPMML-SparkML powered application.</p>

<p>The <code class="language-plaintext highlighter-rouge">org.jpmml.sparkml.bootstrap.Main</code> application demonstrates a two-stage pipeline. The first pipeline stage is a <code class="language-plaintext highlighter-rouge">RFormula</code> transformer that simply selects columns from a CSV input file. The second pipeline stage is either a <code class="language-plaintext highlighter-rouge">DecisionTreeRegressor</code> or <code class="language-plaintext highlighter-rouge">DecisionTreeClassifier</code> predictor that finds the best approximation between the label column and feature columns. The result is written to a PMML output file.</p>

<p>The exercise starts with training a classification-type decision tree model for the <a href="https://archive.ics.uci.edu/ml/datasets/Wine+Quality">“wine quality” dataset</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ $SPARK_HOME/bin/spark-submit \
  --class org.jpmml.sparkml.bootstrap.Main \
  /path/to/jpmml-sparkml-bootstrap/target/bootstrap-1.0-SNAPSHOT.jar \
  --formula "color ~ . -quality" \
  --csv-input /path/to/jpmml-sparkml-bootstrap/src/test/resources/wine.csv \
  --function CLASSIFICATION \
  --pmml-output wine-color.pmml
</code></pre></div></div>

<p>The resulting <code class="language-plaintext highlighter-rouge">wine-color.pmml</code> file can be opened for inspection in a text editor.</p>

<h3 id="the-essentials-of-the-pmml-representation">The essentials of the PMML representation</h3>

<p>A PMML document specifies a workflow for transforming an input data record to an output data record.
The end user interacts with the entry and exit interfaces of the workflow, and can completely disregard its internals.</p>

<p>The design and implementation of these two interfaces is PMML engine-specific. The <a href="https://github.com/jpmml/jpmml-evaluator">JPMML-Evaluator</a> library is geared towards maximum automation. The entry interface exposes complete description of active fields. Similarly, the exit interface exposes complete description of the primary target field and secondary output fields. A capable agent can use this information to format input data record and parse output data records without any external help.</p>

<h5 id="input">Input</h5>

<p>The decision tree model is represented as the <code class="language-plaintext highlighter-rouge">/PMML/TreeModel</code> element. Its schema is defined by the combination of <code class="language-plaintext highlighter-rouge">MiningSchema</code> and <code class="language-plaintext highlighter-rouge">Output</code> child elements.</p>

<p>A <code class="language-plaintext highlighter-rouge">MiningField</code> element serves as a collection of “import” and “export” statements. It refers to some field, and stipulates its role and requirements in the context of the current model element. The fields themselves are declared as <code class="language-plaintext highlighter-rouge">/PMML/DataDictionary/DataField</code> and <code class="language-plaintext highlighter-rouge">/PMML/TransformationDictionary/DerivedField</code> elements.</p>

<p>The wine color model defines eight input fields (“fixed_acidity”, “volatile_acidity”, .., “sulphates”). The values of input fields are prepared by performing type conversion from the user-specified representation to the PMML representation, which is followed by categorization into valid, invalid or missing subspaces, and application of subspace-specific treatments.</p>

<p>The default definition of the “fixed_acidity” input field:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PMML&gt;</span>
  <span class="nt">&lt;DataDictionary&gt;</span>
    <span class="nt">&lt;DataField</span> <span class="na">name=</span><span class="s">"fixed_acidity"</span> <span class="na">optype=</span><span class="s">"continuous"</span> <span class="na">dataType=</span><span class="s">"double"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/DataDictionary&gt;</span>
  <span class="nt">&lt;TreeModel&gt;</span>
    <span class="nt">&lt;MiningSchema&gt;</span>
      <span class="nt">&lt;MiningField</span> <span class="na">name=</span><span class="s">"fixed_acidity"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/MiningSchema&gt;</span>
  <span class="nt">&lt;/TreeModel&gt;</span>
<span class="nt">&lt;/PMML&gt;</span>
</code></pre></div></div>

<p>The same, after manual enhancement:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PMML&gt;</span>
  <span class="nt">&lt;DataDictionary&gt;</span>
    <span class="nt">&lt;DataField</span> <span class="na">name=</span><span class="s">"fixed_acidity"</span> <span class="na">optype=</span><span class="s">"continuous"</span> <span class="na">dataType=</span><span class="s">"double"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Value</span> <span class="na">value=</span><span class="s">"?"</span> <span class="na">property=</span><span class="s">"missing"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Interval</span> <span class="na">closure=</span><span class="s">"closure"</span> <span class="na">leftMargin=</span><span class="s">"3.8"</span> <span class="na">rightMargin=</span><span class="s">"15.9"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/DataField&gt;</span>
  <span class="nt">&lt;/DataDictionary&gt;</span>
  <span class="nt">&lt;TreeModel&gt;</span>
    <span class="nt">&lt;MiningSchema&gt;</span>
      <span class="nt">&lt;MiningField</span> <span class="na">name=</span><span class="s">"fixed_acidity"</span> <span class="na">invalidValueTreatment=</span><span class="s">"returnInvalid"</span> <span class="na">missingValueReplacement=</span><span class="s">"7.215307"</span> <span class="na">missingValueTreatment=</span><span class="s">"asMean"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/MiningSchema&gt;</span>
  <span class="nt">&lt;/TreeModel&gt;</span>
<span class="nt">&lt;/PMML&gt;</span>
</code></pre></div></div>

<p>The enhanced definition reads:</p>

<ol>
  <li>If the user didn’t supply a value for the “fixed_acidity” input field, or its string representation is equal to string constant “?”, then replace it with string constant “7.215307”.</li>
  <li>Convert the value to <code class="language-plaintext highlighter-rouge">double</code> data type and <code class="language-plaintext highlighter-rouge">continuous</code> operational type.</li>
  <li>If the value is in range [3.8, 15.9], then pass it on to the model element. Otherwise, throw an “invalid value” exception.</li>
</ol>

<h5 id="output">Output</h5>

<p>The primary target field may be accompanied by a set of secondary output fields, which expose additional details about the prediction.
For example, classification models typically return the label of the winning class as the primary result, and the breakdown of the class probability distribution as the secondary result.</p>

<p>Secondary output fields are declared as <code class="language-plaintext highlighter-rouge">Output/OutputField</code> elements.</p>

<p>Apache Spark ML models indicate the availability of additional details by implementing marker interfaces.
The conversion engine keeps an eye out for the <code class="language-plaintext highlighter-rouge">org.apache.spark.ml.param.shared.HasProbabilityCol</code> marker interface. It is considered a proof that the classification model is capable of estimating class probability distribution, which is a prerequisite for encoding an <code class="language-plaintext highlighter-rouge">Output</code> element that contains probability-type <code class="language-plaintext highlighter-rouge">OutputField</code> child elements.</p>

<p>The wine color model defines a primary target field (“color”), and two secondary output fields (“probability_white” and “probability_red”):</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PMML&gt;</span>
  <span class="nt">&lt;DataDictionary&gt;</span>
    <span class="nt">&lt;DataField</span> <span class="na">name=</span><span class="s">"color"</span> <span class="na">optype=</span><span class="s">"categorical"</span> <span class="na">dataType=</span><span class="s">"string"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Value</span> <span class="na">value=</span><span class="s">"white"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;Value</span> <span class="na">value=</span><span class="s">"red"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/DataField&gt;</span>
  <span class="nt">&lt;/DataDictionary&gt;</span>
  <span class="nt">&lt;TreeModel&gt;</span>
    <span class="nt">&lt;MiningSchema&gt;</span>
      <span class="nt">&lt;MiningField</span> <span class="na">name=</span><span class="s">"color"</span> <span class="na">usageType=</span><span class="s">"target"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/MiningSchema&gt;</span>
    <span class="nt">&lt;Output&gt;</span>
      <span class="nt">&lt;OutputField</span> <span class="na">name=</span><span class="s">"probability_white"</span> <span class="na">feature=</span><span class="s">"probability"</span> <span class="na">value=</span><span class="s">"white"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;OutputField</span> <span class="na">name=</span><span class="s">"probability_red"</span> <span class="na">feature=</span><span class="s">"probability"</span> <span class="na">value=</span><span class="s">"red"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Output&gt;</span>
  <span class="nt">&lt;/TreeModel&gt;</span>
<span class="nt">&lt;/PMML&gt;</span>
</code></pre></div></div>

<p>In case of decision tree models, it is often desirable to obtain information about the decision path.
The identifier of the winning decision tree leaf can be queried by declaring an extra entityId-type <code class="language-plaintext highlighter-rouge">OutputField</code> element:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PMML&gt;</span>
  <span class="nt">&lt;TreeModel&gt;</span>
    <span class="nt">&lt;Output&gt;</span>
      <span class="nt">&lt;OutputField</span> <span class="na">name=</span><span class="s">"winnerId"</span> <span class="na">feature=</span><span class="s">"entityId"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/Output&gt;</span>
  <span class="nt">&lt;/TreeModel&gt;</span>
<span class="nt">&lt;/PMML&gt;</span>
</code></pre></div></div>

<p>Apache Spark does not assign explicit identifiers to decision tree nodes.
Therefore, a PMML engine would be returning implicit identifiers in the form of a 1-based index, which are perfectly adequate for distinguishing between winning decision tree leafs.</p>

<p>The JPMML-Evaluator and JPMML-Model libraries provides rich APIs that can resolve node identifiers to <code class="language-plaintext highlighter-rouge">org.dmg.pmml.Node</code> class model objects, and backtrack these to the root of the decision tree.</p>

<h5 id="transformations">Transformations</h5>

<p>From the PMML perspective, Apache Spark ML data transformations can be classified as “real” or “pseudo”.
A “real” transformation performs a computation on a feature or a feature vector. It is encoded as one or more <code class="language-plaintext highlighter-rouge">/PMML/DataDictionary/DerivedField</code> elements.</p>

<p>Examples of “real” transformers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Binarizer</code></li>
  <li><code class="language-plaintext highlighter-rouge">Bucketizer</code></li>
  <li><code class="language-plaintext highlighter-rouge">MinMaxScaler</code></li>
  <li><code class="language-plaintext highlighter-rouge">PCA</code></li>
  <li><code class="language-plaintext highlighter-rouge">QuantileDiscretizer</code></li>
  <li><code class="language-plaintext highlighter-rouge">StandardScaler</code></li>
</ul>

<p>A <code class="language-plaintext highlighter-rouge">Binarizer</code> transformer for “discretizing” wine samples based on their sweetness:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Binarizer</span> <span class="n">sweetnessBinarizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Binarizer</span><span class="o">()</span>
  <span class="o">.</span><span class="na">setThreshold</span><span class="o">(</span><span class="mi">6</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setInputCol</span><span class="o">(</span><span class="s">"residual_sugar"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setOutputColumn</span><span class="o">(</span><span class="s">"sweet_indicator"</span><span class="o">);</span>
</code></pre></div></div>

<p>The above, after conversion to the PMML representation:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;PMML&gt;</span>
  <span class="nt">&lt;DataDictionary&gt;</span>
    <span class="nt">&lt;DerivedField</span> <span class="na">name=</span><span class="s">"sweet_indicator"</span> <span class="na">dataType=</span><span class="s">"double"</span> <span class="na">optype=</span><span class="s">"continuous"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Apply</span> <span class="na">function=</span><span class="s">"if"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Apply</span> <span class="na">function=</span><span class="s">"lessOrEqual"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;FieldRef</span> <span class="na">field=</span><span class="s">"residual_sugar"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;Constant&gt;</span>6.0<span class="nt">&lt;/Constant&gt;</span>
        <span class="nt">&lt;/Apply&gt;</span>
        <span class="nt">&lt;Constant&gt;</span>0.0<span class="nt">&lt;/Constant&gt;</span>
        <span class="nt">&lt;Constant&gt;</span>1.0<span class="nt">&lt;/Constant&gt;</span>
      <span class="nt">&lt;/Apply&gt;</span>
    <span class="nt">&lt;/DerivedField&gt;</span>
  <span class="nt">&lt;/DataDictionary&gt;</span>
<span class="nt">&lt;/PMML&gt;</span>
</code></pre></div></div>

<p>A “pseudo” transformation performs Apache Spark ML-specific housekeeping work such as assembling, disassembling or subsetting feature vectors.</p>

<p>Examples of “pseudo” transformers:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ChiSqSelector</code></li>
  <li><code class="language-plaintext highlighter-rouge">IndexToString</code></li>
  <li><code class="language-plaintext highlighter-rouge">OneHotEncoder</code></li>
  <li><code class="language-plaintext highlighter-rouge">RFormula</code></li>
  <li><code class="language-plaintext highlighter-rouge">StringIndexer</code></li>
  <li><code class="language-plaintext highlighter-rouge">VectorAssembler</code></li>
  <li><code class="language-plaintext highlighter-rouge">VectorSlicer</code></li>
</ul>

<p>The conversion engine is capable of performing smart analyses and optimizations in order to produce a maximally compact and expressive PMML document.
The case in point is the identification and pruning of unused field declarations, which improves the robustness and performance of production workflows</p>

<p>For example, the <code class="language-plaintext highlighter-rouge">wine.csv</code> CSV document contains 11 feature columns, but the wine color model reveals that three of them (“residual_sugar”, “free_sulfur_dioxide” and “alcohol”) do not contribute to the discrimination between white and red wines in any way.
The conversion engine takes notice of that and omits all the related data transformations from the workflow, thereby eliminating three-elevenths of the complexity.</p>

<h3 id="importing-pmml-to-openscoring-rest-web-service">Importing PMML to Openscoring REST web service</h3>

<p><a href="https://github.com/openscoring/openscoring">Openscoring</a> provides a way to expose a machine learning model as a REST web service.
The primary design consideration is to make machine learning models easily discoverable and usable (a variation of the <a href="https://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a> theme) for human and machine agents alike. 
The PMML representation is perfect fit thanks to the availability of rich descriptive metadata. Other representations can be plugged into the framework with the help of wrappers that satisfy the requested metadata query needs.</p>

<p>Openscoring is minimalistic Java web application that conforms to Servlet and JAX-RS specifications.</p>

<p>It can be built from the source checkout using <a href="https://maven.apache.org/">Apache Maven</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/openscoring/openscoring.git
$ cd openscoring
$ mvn clean package
</code></pre></div></div>

<p>Openscoring exists in two variants. First, the standalone command-line application variant <code class="language-plaintext highlighter-rouge">openscoring-server/target/server-executable-${version}.jar</code> is based on Jetty web server. Easy configuration and almost instant startup and shutdown times make it suitable for local development and testing use cases. The web application (WAR) variant <code class="language-plaintext highlighter-rouge">openscoring-webapp/target/openscoring-webapp-${version}.war</code> is more suitable for production use cases. It can be deployed on any standards-compliant Java web- or application container, and secured and scaled according to organization’s preferences.</p>

<p>Alternatively, release versions of the Openscoring WAR file can be downloaded from the <a href="https://central.maven.org/maven2/org/openscoring/openscoring-webapp/"><code class="language-plaintext highlighter-rouge">org/openscoring/openscoring-webapp</code></a> section of the Maven Central repository.</p>

<p>A demo instance of Openscoring can be launched by dropping its WAR file into the auto-deployment directory of a running <a href="https://tomcat.apache.org/">Apache Tomcat</a> web container:</p>

<ol>
  <li>Download the latest <code class="language-plaintext highlighter-rouge">openscoring-webapp-${version}.war</code> file from the Maven Central repository to a temporary directory. At the time of writing this, it is <a href="https://central.maven.org/maven2/org/openscoring/openscoring-webapp/1.2.15/openscoring-webapp-1.2.15.war"><code class="language-plaintext highlighter-rouge">openscoring-webapp-1.2.15.war</code></a>.</li>
  <li>Rename the downloaded file to <code class="language-plaintext highlighter-rouge">openscoring.war</code>. Apache Tomcat generates the context path for a web application from the filename part of the WAR file. So, the context path for <code class="language-plaintext highlighter-rouge">openscoring.war</code> will be “/openscoring/” (whereas for the original <code class="language-plaintext highlighter-rouge">openscoring-webapp-${version}.war</code> it would have been “/openscoring-webapp-${version}/”).</li>
  <li>Move the <code class="language-plaintext highlighter-rouge">openscoring.war</code> file from the temporary directory to the <code class="language-plaintext highlighter-rouge">$CATALINA_HOME/webapps</code> auto-deployment directory. Allow the directory watchdog thread a couple of seconds to unpack and deploy the web application.</li>
  <li>Verify the deployment by accessing <a href="http://localhost:8080/openscoring/model">http://localhost:8080/openscoring/model</a>. Upon success, the response body should be an empty JSON object <code class="language-plaintext highlighter-rouge">{ }</code>.</li>
</ol>

<p>Openscoring maps every PMML document to a <code class="language-plaintext highlighter-rouge">/model/${id}</code> endpoint, which provides model-oriented information and services according to the <a href="https://github.com/openscoring/openscoring#rest-api">REST API specification</a>.</p>

<p>Model deployment, download and undeployment are privileged actions that are only accessible to users with the “admin” role. All the unprivileged actions are accessible to all users.
This basic access and authorization control can be overriden at the Java web container level. For example, configuring Servet filters that restrict the visibility of endpoints by some prefix/suffix, restrict the number of data records that can be evaluated in a time period, etc.</p>

<h5 id="deployment">Deployment</h5>

<p>Adding the wine color model:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -X PUT --data-binary @/path/to/wine-color.pmml -H "Content-type: text/xml" http://localhost:8080/openscoring/model/wine-color
</code></pre></div></div>

<p>The response body is an <a href="https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/ModelResponse.java"><code class="language-plaintext highlighter-rouge">org.openscoring.common.ModelResponse</code></a> object:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"wine-color"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"miningFunction"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"classification"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"summary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"Tree model"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"properties"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"created.timestamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-06-19T21:35:58.592+0000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"accessed.timestamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"file.size"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">13537</span><span class="p">,</span><span class="w">
    </span><span class="nl">"file.md5sum"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1a4eb6324dc14c00188aeac2dfd6bb03"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"schema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"activeFields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"fixed_acidity"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"volatile_acidity"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"citric_acid"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"chlorides"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"total_sulfur_dioxide"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"density"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"pH"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"sulphates"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"targetFields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"color"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"categorical"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"values"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"white"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"outputFields"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"probability_white"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"probability_red"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dataType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"opType"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"continuous"</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The pattern is to move all model-related logic to the server side, so that Openscoring client applications could be developed and used on a wide variety of platforms by people with varying degrees of experience.</p>

<p>All agents should be able to parse the above object at the basic model identification and schema level.
For example, understanding that the REST endpoint <code class="language-plaintext highlighter-rouge">/model/wine-color</code> holds a classification-type decision tree model, which consumes an eight-element input data record, and produces a three-element output data record.</p>

<p>More sophisticated agents could rise to elevated model verification and field schema levels.
For example, checking that the reported file size and MD5 checksum are correct, and establishing field mappings between the model and the data store.</p>

<h5 id="evaluation">Evaluation</h5>

<p>Evaluating the wine color model in single prediction mode:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -X POST --data-binary @/path/to/data_record.json -H "Content-type: application/json" http://localhost:8080/openscoring/model/wine-color
</code></pre></div></div>

<p>The request body is an <a href="https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/EvaluationRequest.java"><code class="language-plaintext highlighter-rouge">org.openscoring.common.EvaluationRequest</code></a> object:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"sample-1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"arguments"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"fixed_acidity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">7.4</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volatile_acidity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span><span class="w">
    </span><span class="nl">"citric_acid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"chlorides"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.076</span><span class="p">,</span><span class="w">
    </span><span class="nl">"total_sulfur_dioxide"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w">
    </span><span class="nl">"density"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.9978</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pH"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">3.51</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sulphates"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.56</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The response body is an <a href="https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/EvaluationResponse.java"><code class="language-plaintext highlighter-rouge">org.openscoring.common.EvaluationResponse</code></a> object:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"sample-1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"result"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"color"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"probability_white"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">8.264462809917355E-4</span><span class="p">,</span><span class="w">
    </span><span class="nl">"probability_red"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mf">0.9991735537190083</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Evaluating the wine color model in CSV mode:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -X POST --data-binary @/path/to/wine.csv -H "Content-type: text/plain; charset=UTF-8" http://localhost:8080/openscoring/model/wine-color/csv &gt; /path/to/wine-color.csv
</code></pre></div></div>

<h5 id="undeployment">Undeployment</h5>

<p>Removing the wine color model:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -X DELETE http://localhost:8080/openscoring/model/wine-color
</code></pre></div></div>

<h5 id="openscoring-client-libraries">Openscoring client libraries</h5>

<p>The Openscoring REST API is fairly mature and stable.
The majority of changes happen in the “REST over HTTP(S)” transport layer. For example, adding support for new data formats and encodings, new user authentication mechanisms, etc.</p>

<p>Openscoring client libraries provide easy and effective means for keeping up with changes. Application developers get to focus on high-level routines such as “deploy”, “evaluate” and “undeploy” commands, whose syntactics and semantics should remain stable for extended period of time.</p>

<p>The Java client library is part of the Openscoring project. Other client libraries (Python, R, PHP) are isolated into their own projects.</p>

<p>For example, the following Python script uses the <a href="https://github.com/openscoring/openscoring-python">Openscoring-Python</a> library to replicate the example workflow.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">openscoring</span>

<span class="n">os</span> <span class="o">=</span> <span class="n">openscoring</span><span class="p">.</span><span class="n">Openscoring</span><span class="p">(</span><span class="s">"http://localhost:8080/openscoring"</span><span class="p">)</span>

<span class="c1"># Deployment
</span><span class="n">os</span><span class="p">.</span><span class="n">deploy</span><span class="p">(</span><span class="s">"wine-color"</span><span class="p">,</span> <span class="s">"/path/to/wine-color.pmml"</span><span class="p">)</span>

<span class="c1"># Evaluation in single prediction mode
</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">"fixed_acidity"</span> <span class="p">:</span> <span class="mf">7.4</span><span class="p">,</span>
  <span class="s">"volatile_acidity"</span> <span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
  <span class="s">"citric_acid"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s">"chlorides"</span> <span class="p">:</span> <span class="mf">0.076</span><span class="p">,</span>
  <span class="s">"total_sulfur_dioxide"</span> <span class="p">:</span> <span class="mi">34</span><span class="p">,</span>
  <span class="s">"density"</span> <span class="p">:</span> <span class="mf">0.9978</span><span class="p">,</span>
  <span class="s">"pH"</span> <span class="p">:</span> <span class="mf">3.51</span><span class="p">,</span>
  <span class="s">"sulphates"</span> <span class="p">:</span> <span class="mf">0.56</span>
<span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s">"wine-color"</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># Evaluation in CSV mode
</span><span class="n">os</span><span class="p">.</span><span class="n">evaluateCsv</span><span class="p">(</span><span class="s">"wine-color"</span><span class="p">,</span> <span class="s">"/path/to/wine.csv"</span><span class="p">,</span> <span class="s">"/path/to/wine-color.csv"</span><span class="p">)</span>

<span class="c1"># Undeployment
</span><span class="n">os</span><span class="p">.</span><span class="n">undeploy</span><span class="p">(</span><span class="s">"wine-color"</span><span class="p">)</span>
</code></pre></div></div>

  </main>
</div>



  <footer class="c-footer bg-primary">
  <div class="c-footer__container container">
    <a class="c-footer__logo" href="index.html"><img src="/assets/images/logo-w.svg" alt="" /></a>
    <div class="c-footer__info">
      <div class="c-footer__text">© 2022 - Openscoring.io</div>
    </div><a class="c-footer__social" href="https://twitter.com/openscoring" target="_blank">
      Follow Openscoring on Twitter
    </a>
  </div>
</footer>

  <script>
    var sc_project = 11704106;
    var sc_security = "a7d1bf16";
    var sc_invisible = 1;
    var scJsHost = (("https:" == document.location.protocol) ?
      "https://secure." : "http://www.");
  </script>

  <script type="text/javascript" src="https://secure.statcounter.com/counter/counter.js" async=""></script>

  <noscript>
    <div class="statcounter">
      <a title="web analytics" href="https://statcounter.com/">
        <img class="statcounter" src="https://c.statcounter.com/11704106/0/a7d1bf16/1/" alt="web analytics" />
      </a>
    </div>
  </noscript>

  <script type="text/javascript" src="/assets/js/bootstrap.bundle.min.js" defer></script>
  <script type="text/javascript" src="/assets/js/swiper/swiper.min.js" defer></script>
  <script type="text/javascript" src="/assets/js/functions.js" defer></script>
</body>

</html>